<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Talk 2Me Nice</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
:root{
  --bg-main: linear-gradient(160deg,#1b1f27,#2a2f3b);
  --bg-card:#2c313d;
  --accent:#ffb86c;
  --text:#e1e4ea;
  --muted:#a1a6b0;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Montserrat,system-ui,sans-serif;
  background:var(--bg-main);
  color:var(--text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* Brand wave background */
.brandWave{
  position:fixed;
  inset:0;
  z-index:-1;
  background:
    radial-gradient(circle at 20% 30%,rgba(255,184,108,.08),transparent 40%),
    radial-gradient(circle at 80% 70%,rgba(255,184,108,.06),transparent 40%);
  animation:calmWave 12s ease-in-out infinite;
}
@keyframes calmWave{
  0%{transform:translateY(0)}
  50%{transform:translateY(-8px)}
  100%{transform:translateY(0)}
}

/* ---------- LOGIN / WELCOME ---------- */
#loginOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.loginCard{
  background:var(--bg-card);
  padding:2rem;
  border-radius:18px;
  width:100%;
  max-width:360px;
  text-align:center;
}
.loginCard h1{
  font-family:"Playfair Display",serif;
  margin-top:0;
  color:var(--accent);
}
.loginCard input{
  width:100%;
  padding:.7rem;
  border-radius:12px;
  border:none;
  background:#1f232d;
  color:var(--text);
  margin-bottom:1rem;
}
.loginCard button{
  width:100%;
  padding:.7rem;
  border-radius:999px;
  border:none;
  background:var(--accent);
  cursor:pointer;
}

/* ---------- LAYOUT ---------- */
#app{
  max-width:1000px;
  margin:2rem auto;
  display:flex;
  gap:1rem;
}
#sidebar{
  width:240px;
  background:var(--bg-card);
  border-radius:16px;
  padding:1rem;
}
#chatArea{
  flex:1;
  background:var(--bg-card);
  border-radius:16px;
  padding:1rem;
  display:flex;
  flex-direction:column;
}

/* Sidebar sections */
.profile p{margin:.2rem 0;font-size:.9rem}
select{
  width:100%;
  padding:.5rem;
  border-radius:10px;
  background:#1f232d;
  color:var(--text);
  border:none;
}
.sectionTitle{
  color:var(--accent);
  margin-top:1rem;
  font-weight:600;
}

/* ---------- CHAT ---------- */
#chat{
  flex:1;
  overflow-y:auto;
}
.message{
  max-width:75%;
  padding:.8rem 1.1rem;
  border-radius:18px;
  margin-bottom:.6rem;
  line-height:1.4;
  animation:fadeIn .4s forwards;
}
.user{
  background:var(--accent);
  color:#1b1f27;
  align-self:flex-end;
}
.bot{
  background:#1f232d;
  align-self:flex-start;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(8px)}
  to{opacity:1;transform:translateY(0)}
}

/* ---------- FOOTER ---------- */
footer{
  display:flex;
  gap:.5rem;
  padding:1rem;
}
footer input{
  flex:1;
  padding:.6rem;
  border-radius:12px;
  border:none;
  background:#1f232d;
  color:var(--text);
}
footer button{
  padding:.6rem 1rem;
  border-radius:999px;
  border:none;
  background:var(--accent);
  cursor:pointer;
}

/* MIC */
#mic.listening{
  animation:pulse 1.2s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,184,108,.6)}
  70%{box-shadow:0 0 0 14px rgba(255,184,108,0)}
  100%{box-shadow:0 0 0 0 rgba(255,184,108,0)}
}
</style>
</head>
<body>
<div class="brandWave"></div>

<!-- LOGIN -->
<div id="loginOverlay">
  <div class="loginCard">
    <h1>Talk 2Me Nice</h1>
    <p>What should we call you?</p>
    <input id="nicknameInput" placeholder="Nickname"/>
    <button onclick="enterApp()">Enter</button>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div id="sidebar">
    <div class="profile">
      <p>ðŸ‘¤ <strong id="nameLabel"></strong></p>
      <p>ðŸ§š <span id="companionLabel"></span></p>
    </div>

    <div class="sectionTitle">Companion</div>
    <select id="companionSelect">
      <option value="Whisp">Whisp (calm)</option>
      <option value="Ace">Ace (playful)</option>
      <option value="Sage">Sage (clear)</option>
      <option value="School">School Mode</option>
    </select>

    <div class="sectionTitle">Language</div>
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="es">EspaÃ±ol</option>
      <option value="fr">FranÃ§ais</option>
      <option value="pt">PortuguÃªs</option>
    </select>

    <div class="sectionTitle">Conversation Starter</div>
    <select id="starterSelect">
      <option value="">â€” select one â€”</option>
      <option>Howâ€™s your day feeling so far?</option>
      <option>Want to talk or just think out loud?</option>
      <option>Whatâ€™s been sitting on your mind?</option>
    </select>
  </div>

  <div id="chatArea">
    <div id="chat"></div>
  </div>
</div>

<footer style="display:none">
  <input id="input" placeholder="Type hereâ€¦" onkeydown="if(event.key==='Enter')send()"/>
  <button id="mic" onclick="voiceIn()">ðŸŽ¤</button>
  <button onclick="send()">Send</button>
</footer>

<script>
/* ---------- STATE ---------- */
const state={
  user:{name:""},
  companion:"Whisp",
  language:"en",
  emotionalLoad:"neutral",
  starterUsed:false,
  voiceAllowed:true
};

/* ---------- LOGIN ---------- */
function enterApp(){
  const name=nicknameInput.value.trim();
  if(!name)return alert("Enter a nickname");
  state.user.name=name;
  state.language = localStorage.getItem("language") || "en";
  localStorage.setItem("name",name);
  loginOverlay.style.display="none";
  app.style.display="flex";
  document.querySelector("footer").style.display="flex";
  nameLabel.textContent=name;
  companionLabel.textContent=state.companion;
  languageSelect.value = state.language;
  greet();
}

/* ---------- EI ENGINE (Multilingual) ---------- */
function assess(text){
  const patterns = {
    en:{high:/!{2,}|panic|overwhelmed|angry|stressed/i,low:/ok|fine|sure/i},
    es:{high:/!{2,}|ansioso|abrumado|enojado|estresado/i,low:/bien|ok|vale/i},
    fr:{high:/!{2,}|anxieux|dÃ©bordÃ©|Ã©nervÃ©|stressÃ©/i,low:/Ã§a va|bien|ok/i},
    pt:{high:/!{2,}|ansioso|sobrecarregado|irritado|estressado/i,low:/bem|ok|tÃ¡/i}
  };
  const lang = patterns[state.language] || patterns.en;
  if(lang.high.test(text)) return "high";
  if(lang.low.test(text)) return "low";
  return "neutral";
}

/* ---------- RESPONSES ---------- */
function generateReply(){
  const replies = {
    en:{high:"Letâ€™s slow this down together. Youâ€™re not alone here.",neutral:"I hear you. Want to keep going?",low:"Iâ€™m here whenever you want to talk."},
    es:{high:"Vamos a bajar el ritmo juntos. No estÃ¡s solo aquÃ­.",neutral:"Te escucho. Â¿Quieres seguir?",low:"AquÃ­ estoy cuando quieras hablar."},
    fr:{high:"On peut ralentir ensemble. Tu nâ€™es pas seul ici.",neutral:"Je tâ€™Ã©coute. Tu veux continuer ?",low:"Je suis lÃ  quand tu veux."},
    pt:{high:"Vamos desacelerar juntos. VocÃª nÃ£o estÃ¡ sozinho.",neutral:"Estou te ouvindo. Quer continuar?",low:"Estou aqui quando quiser falar."}
  };
  if(state.companion==="School") state.emotionalLoad="neutral";
  const langReplies = replies[state.language] || replies.en;
  return langReplies[state.emotionalLoad];
}

/* ---------- CHAT ---------- */
function add(text,who){
  const div=document.createElement("div");
  div.className=`message ${who}`;
  div.textContent=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function send(msg){
  const text = msg || input.value.trim();
  if(!text) return;
  add(text,"user");
  input.value="";
  state.emotionalLoad=assess(text);
  setTimeout(()=>{
    const reply=generateReply();
    add(reply,"bot");
    speak(reply);
  },600);
}

/* ---------- STARTERS ---------- */
starterSelect.onchange=()=>{
  if(state.starterUsed||!starterSelect.value)return;
  state.starterUsed=true;
  send(starterSelect.value);
};

/* ---------- COMPANION ---------- */
companionSelect.onchange=()=>{
  state.companion=companionSelect.value;
  companionLabel.textContent=state.companion;
};

/* ---------- LANGUAGE ---------- */
languageSelect.onchange=()=>{
  state.language=languageSelect.value;
  localStorage.setItem("language",state.language);
};

/* ---------- VOICE ---------- */
function speak(text){
  if(!state.voiceAllowed || state.emotionalLoad==="high") return;
  const utter=new SpeechSynthesisUtterance(text);
  const voiceMap={en:"en-US",es:"es-ES",fr:"fr-FR",pt:"pt-BR"};
  utter.lang=voiceMap[state.language]||"en-US";
  speechSynthesis.speak(utter);
}
function voiceIn(){
  const R=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!R)return alert("Voice not supported");
  const r=new R();
  r.onresult=e=>send(e.results[0][0].transcript);
  mic.classList.add("listening");
  r.onend=()=>mic.classList.remove("listening");
  r.start();
}

/* ---------- GREETING ---------- */
function greet(){
  const lastTone=localStorage.getItem("tone");
  if(lastTone){
    add(`Last time you preferred a calm tone. We can keep that.`,"bot");
  } else {
    add("Iâ€™m here. We can talk at your pace.","bot");
  }
}
</script>
</body>
</html>
