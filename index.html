<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talk 2Me Nice</title>
<style>
:root {
  --bg-page:#1a1a1a;
  --bg-chat:#2a2a2a;
  --bg-card:#333;
  --text-color:#fff;
  --accent:#ffb86c;
}
body{margin:0;font-family:sans-serif;background:var(--bg-page);color:var(--text-color);}
#landingPage, #chatContainer, #summaryModal, #welcomeBackModal, #reviewPromptModal {display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;}
.hidden{display:none;}
#companionDisplay{display:flex;flex-direction:column;align-items:center;margin-bottom:1rem;}
#companionVisual{width:120px;height:120px;display:flex;align-items:center;justify-content:center;transition: transform 0.3s, box-shadow 0.3s;}
#companionVisual.speaking{animation:bounce 0.6s infinite alternate;}
@keyframes bounce{0%{transform:scale(1);}50%{transform:scale(1.05) translateY(-5px);}100%{transform:scale(1);}}
.companionWhisp{background:#b3e5fc;border-radius:50%;}
.companionStar{background:gold;clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);}
.companionRobot{background:silver;border-radius:20%;}
.companionCloud{background:#e0f7fa;border-radius:40% 60% 50% 50%;}
#chatBox{width:80%;max-width:600px;height:300px;background:var(--bg-chat);overflow-y:auto;padding:1rem;border-radius:12px;margin-bottom:1rem;}
.message{margin:0.2rem 0;padding:0.3rem 0.5rem;border-radius:8px;}
.message.user{background:#444;text-align:right;}
.message.bot{background:#555;text-align:left;}
#chatControls{display:flex;gap:0.5rem;margin-top:0.5rem;}
button{padding:0.5rem 1rem;border:none;border-radius:8px;background:var(--accent);color:#000;cursor:pointer;}
.onboardCard{background:var(--bg-card);padding:2rem;border-radius:18px;text-align:center;}
.highlightWord{padding:0.2rem 0.5rem;border-radius:8px;transition:background 0.3s;}
</style>
</head>
<body>

<!-- Landing Page -->
<div id="landingPage">
  <h1>Talk 2Me Nice</h1>
  <input type="text" id="nicknameInput" placeholder="Enter your name">
  <select id="companionSelect">
    <option>Whisp</option>
    <option>Star</option>
    <option>Robot</option>
    <option>Cloud</option>
  </select>
  <select id="languageSelect">
    <option value="en-US">English</option>
    <option value="es-ES">Spanish</option>
    <option value="fr-FR">French</option>
    <option value="de-DE">German</option>
  </select>
  <button onclick="startSession()">Start</button>
</div>

<!-- Chat Container -->
<div id="chatContainer" class="hidden">
  <div id="companionDisplay">
    <div id="companionVisual" class="companionWhisp"></div>
    <p id="companionName">Whisp</p>
  </div>
  <div id="chatBox"></div>
  <div id="chatControls">
    <input type="text" id="userInput" placeholder="Type here">
    <button onclick="sendMessage()">Send</button>
    <button id="repeatLineBtn" onclick="repeatLastLine()">üîÅ Repeat</button>
    <button onclick="stopSpeaking()">‚èπ Stop</button>
    <button onclick="rephraseLastLine()">üí° Another way</button>
  </div>
</div>

<!-- Summary Modal -->
<div id="summaryModal" class="hidden">
  <div class="onboardCard">
    <h3>Top Words You Used</h3>
    <ul id="summaryList"></ul>
    <button onclick="closeSummary()">Close</button>
  </div>
</div>

<!-- Welcome Back Modal -->
<div id="welcomeBackModal" class="hidden">
  <div class="onboardCard">
    <p id="welcomeBackText"></p>
    <button onclick="showSummary(); closeWelcomeBack()">Yes, review</button>
    <button onclick="closeWelcomeBack()">No, thanks</button>
  </div>
</div>

<!-- Review Prompt Modal -->
<div id="reviewPromptModal" class="hidden">
  <div class="onboardCard">
    <p id="reviewPromptText"></p>
    <button onclick="showSummary(); closeReviewPrompt()">Yes, show me!</button>
    <button onclick="closeReviewPrompt()">No, thanks</button>
  </div>
</div>

<script>
// -------------------- Globals --------------------
let userMessages = [];
let repeatCounts = {};
let lastBotMessage = "";
let windowVoiceSpeed = 1.0;

// -------------------- Companion Reactions --------------------
const companionReactions = {
  Whisp: { happy:{scale:1.1,color:"#b3e5fc",boxShadow:"0 0 20px #81d4fa"}, neutral:{scale:1,color:"#b3e5fc",boxShadow:"none"}, thinking:{scale:0.95,color:"#90caf9",boxShadow:"0 0 10px #64b5f6"}, curious:{scale:1.05,color:"#82d0f4",boxShadow:"0 0 15px #64b5f6"} },
  Star: { happy:{scale:1.2,color:"gold",boxShadow:"0 0 25px gold"}, neutral:{scale:1,color:"gold",boxShadow:"none"}, excited:{scale:1.3,color:"yellow",boxShadow:"0 0 30px yellow"}, curious:{scale:1.1,color:"#ffd700",boxShadow:"0 0 15px gold"} },
  Robot: { happy:{scale:1.05,color:"silver",boxShadow:"0 0 15px #ccc"}, neutral:{scale:1,color:"silver",boxShadow:"none"}, curious:{scale:1.1,color:"#aaa",boxShadow:"0 0 10px #999"} },
  Cloud: { happy:{scale:1.1,color:"#e0f7fa",boxShadow:"0 0 20px #b2ebf2"}, neutral:{scale:1,color:"#e0f7fa",boxShadow:"none"}, surprised:{scale:1.15,color:"#b2ebf2",boxShadow:"0 0 15px #81d4fa"}, curious:{scale:1.05,color:"#b2ebf2",boxShadow:"0 0 10px #81d4fa"} }
};

// -------------------- Conversation Starters --------------------
const conversationStarters = {
  travel:["Hello! How was your trip?","Where would you like to travel today?"],
  food:["What's your favorite dish?","Have you tried something new lately?"],
  daily:["Good morning! Ready to chat?","Hi there! How‚Äôs your day going?"]
};

// -------------------- Start Session --------------------
function startSession(){
  const nickname = document.getElementById("nicknameInput").value.trim() || "Friend";
  localStorage.setItem("nickname",nickname);

  const companion = document.getElementById("companionSelect").value;
  localStorage.setItem("companion",companion);
  updateCompanionVisual(companion);

  const lang = document.getElementById("languageSelect").value;
  localStorage.setItem("language",lang);

  document.getElementById("landingPage").classList.add("hidden");
  document.getElementById("chatContainer").classList.remove("hidden");

  showTyping(`Welcome ${nickname}! ${companion} is ready to chat.`);
  const dailyStarter = getDailyStarter();
  setTimeout(()=>sendMessage(dailyStarter),1200);
}

// -------------------- Companion Visual --------------------
function updateCompanionVisual(id){
  const visual = document.getElementById("companionVisual");
  visual.className="";
  switch(id){
    case "Whisp": visual.classList.add("companionWhisp"); break;
    case "Star": visual.classList.add("companionStar"); break;
    case "Robot": visual.classList.add("companionRobot"); break;
    case "Cloud": visual.classList.add("companionCloud"); break;
  }
  document.getElementById("companionName").textContent = id;
}

// -------------------- Typing & Speech --------------------
function detectTone(text){
  const lower=text.toLowerCase();
  if(/happy|great|fun|good|wow|amazing/.test(lower)) return "happy";
  if(/thinking|hm|let's see|maybe/.test(lower)) return "thinking";
  if(/excited|yay|awesome/.test(lower)) return "excited";
  if(/surprise|oh|really/.test(lower)) return "surprised";
  return "neutral";
}

function triggerCompanionReaction(tone){
  const visual = document.getElementById("companionVisual");
  const companionId = localStorage.getItem("companion") || "Whisp";
  const reaction = companionReactions[companionId][tone] || companionReactions[companionId].neutral;
  visual.style.transform=`scale(${reaction.scale})`;
  visual.style.background=reaction.color;
  visual.style.boxShadow=reaction.boxShadow;
  setTimeout(()=>{
    const neutral=companionReactions[companionId].neutral;
    visual.style.transform=`scale(${neutral.scale})`;
    visual.style.background=neutral.color;
    visual.style.boxShadow=neutral.boxShadow;
  },1000);
}

function speakBotText(text){
  const visual=document.getElementById("companionVisual");
  visual.classList.add("speaking");
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang=localStorage.getItem("language")||"en-US";
  utter.rate=windowVoiceSpeed;
  utter.onend=()=>{visual.classList.remove("speaking");};
  speechSynthesis.speak(utter);
}

function showTyping(text){
  let i=0;
  const div=document.createElement("div");
  div.className="message bot";
  document.getElementById("chatBox").appendChild(div);
  const companionId = localStorage.getItem("companion") || "Whisp";
  const tone=detectTone(text);
  const visual=document.getElementById("companionVisual");
  const reaction=companionReactions[companionId][tone];
  visual.style.transform=`scale(${reaction.scale})`;
  visual.style.background=reaction.color;
  visual.style.boxShadow=reaction.boxShadow;

  function type(){
    if(i<text.length){
      div.textContent+=text[i];i++;
      setTimeout(type,20);
    } else {
      lastBotMessage=text;
      speakBotText(text);
      document.getElementById("chatBox").scrollTop=document.getElementById("chatBox").scrollHeight;
      setTimeout(()=>{
        const neutral=companionReactions[companionId].neutral;
        visual.style.transform=`scale(${neutral.scale})`;
        visual.style.background=neutral.color;
        visual.style.boxShadow=neutral.boxShadow;
      },800);
    }
  }
  type();
}

// -------------------- User Messages --------------------
function sendMessage(msg=null){
  const input=document.getElementById("userInput");
  const userText=msg||input.value.trim();
  if(!userText) return;
  const chatBox=document.getElementById("chatBox");
  const div=document.createElement("div");
  div.className="message user"; div.textContent=userText; chatBox.appendChild(div);
  userMessages.push(userText);
  let stored=JSON.parse(localStorage.getItem("userMessages"))||[];
  stored.push(userText);
  localStorage.setItem("userMessages",JSON.stringify(stored));
  repeatCounts[userText]=(repeatCounts[userText]||0)+1;
  input.value="";

  let response=getAIResponse(userText);

  if(repeatCounts[userText]>=3){
    response=`Hmm, you keep saying "${userText}". Want to see your most-used words?`;
    triggerCompanionReaction("curious");
    showReviewPrompt();
  }

  showTyping(response);
}

function repeatLastLine(){if(lastBotMessage)speakBotText(lastBotMessage);}
function stopSpeaking(){if(speechSynthesis.speaking)speechSynthesis.cancel();document.getElementById("companionVisual").classList.remove("speaking");}
function rephraseLastLine(){if(!lastBotMessage)return; const variations={"Hello!":["Hi there!","Hey!","Greetings!"],"How are you?":["How‚Äôs it going?","How‚Äôs your day?","What‚Äôs up?"],"Good morning!":["Morning!","Hi! Ready for today?","Hello, good morning!"]}; let newLine=lastBotMessage; if(variations[lastBotMessage]){const opts=variations[lastBotMessage]; newLine=opts[Math.floor(Math.random()*opts.length)];} showTyping(newLine);}

// -------------------- Daily Starter --------------------
function getDailyStarter(){const today=new Date().getDay(); const categories=Object.keys(conversationStarters); const cat=categories[today%categories.length]; const starters=conversationStarters[cat]; const index=today%starters.length; return starters[index];}

// -------------------- Word Summary --------------------
function getMostCommonWords(){
  let messages=JSON.parse(localStorage.getItem("userMessages"))||[];
  const wordCounts={};
  messages.join(" ").toLowerCase().replace(/[.,!?]/g,"").split(/\s+/).forEach(word=>{if(word.length>2)wordCounts[word]=(wordCounts[word]||0)+1;});
  return Object.entries(wordCounts).sort((a,b)=>b[1]-a[1]).slice(0,10);
}
function showSummary(){
  const summary=getMostCommonWords();
  const list=document.getElementById("summaryList");
  list.innerHTML="";
  const visual=document.getElementById("companionVisual");
  const companionId=localStorage.getItem("companion")||"Whisp";
  summary.forEach(([word,count],idx)=>{
    const li=document.createElement("li");
    li.textContent=`${word} ‚Äî ${count} times`;
    li.classList.add("highlightWord");
    list.appendChild(li);
    setTimeout(()=>{
      visual.classList.add("speaking");
      li.style.background="#fff3b0";
      const utter=new SpeechSynthesisUtterance(word);
      utter.lang=localStorage.getItem("language")||"en-US";
      utter.rate=0.9;
      utter.onend=()=>{visual.classList.remove("speaking"); li.style.background="";}
      speechSynthesis.speak(utter);
    }, idx*1500);
  });
  document.getElementById("summaryModal").classList.remove("hidden");
}
function closeSummary(){document.getElementById("summaryModal").classList.add("hidden");}

// -------------------- Welcome Back --------------------
function showWelcomeBackPrompt(text){document.getElementById("welcomeBackText").textContent=text;document.getElementById("welcomeBackModal").classList.remove("hidden");}
function closeWelcomeBack(){document.getElementById("welcomeBackModal").classList.add("hidden");}

// -------------------- Review Prompt --------------------
function showReviewPrompt(){document.getElementById("reviewPromptText").textContent="I noticed you‚Äôve been repeating words. Want to review your most-used words?";document.getElementById("reviewPromptModal").classList.remove("hidden");}
function closeReviewPrompt(){document.getElementById("reviewPromptModal").classList.add("hidden");}

// -------------------- Placeholder AI --------------------
function getAIResponse(userText){
  const lower=userText.toLowerCase();
  if(lower.includes("hello")) return "Hello! Nice to see you!";
  if(lower.includes("how are you")) return "I'm doing great! How about you?";
  return "Interesting!";
}

// -------------------- Signature --------------------
console.log("Signed, ELYS");

</script>
</body>
</html>
