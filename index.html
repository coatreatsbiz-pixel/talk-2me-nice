<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talk 2Me Nice</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-main: linear-gradient(160deg, #1b1f27 0%, #2a2f3b 100%);
  --bg-card: #2c313d;
  --accent: #ffb86c;
  --text-main: #e1e4ea;
  --text-muted: #a1a6b0;
}

/* ------------------- BODY & BASIC ------------------- */
body {
  margin:0;
  font-family:'Montserrat',system-ui,sans-serif;
  background: var(--bg-main);
  color: var(--text-main);
  display:flex;
  flex-direction:column;
  min-height:100vh;
  position:relative;
  overflow-x:hidden;
}
h3,h4 { font-family:'Playfair Display', serif; }
button { font-family:'Montserrat', sans-serif; }

/* ------------------- WELCOME OVERLAY ------------------- */
#welcomeOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
.welcomeCard {
  background: var(--bg-card);
  padding: 2rem;
  border-radius: 18px;
  max-width: 400px;
  width: 90%;
  text-align: center;
  color: var(--text-main);
  display: flex;
  flex-direction: column;
  gap: 1rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
}
.welcomeCard input, .welcomeCard select {
  padding: 0.6rem;
  border-radius: 12px;
  border: none;
  background: #1f232d;
  color: var(--text-main);
  width: 100%;
}
.welcomeCard button {
  margin-top: 1rem;
  padding: 0.8rem 1.4rem;
  border-radius: 999px;
  border: none;
  background: var(--accent);
  color: #1b1f27;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}
.welcomeCard button:hover {
  background: #ff9f40;
  transform: scale(1.05);
}

/* Companion Cards in overlay */
.companionGrid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 1rem; }
.companionCardOverlay {
  background: #2c313d;
  border-radius: 14px;
  padding: 0.8rem;
  cursor: pointer;
  text-align: center;
  transition: all 0.25s ease;
  border: 2px solid transparent;
}
.companionCardOverlay.active {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(255,184,108,0.25);
}
.companionCardOverlay:hover {
  transform: translateY(-3px);
  box-shadow:0 6px 12px rgba(0,0,0,0.35);
}

/* ------------------- CHAT CONTAINER ------------------- */
#chatContainer {
  flex: 1 1 auto;
  display:flex;
  gap:1rem;
  animation:fadeIn 0.8s ease-out;
  min-height: calc(100vh - 80px);
  z-index:1;
}
#profileSidebar {
  width:220px;
  padding:1rem;
  background: var(--bg-card);
  border-radius:16px;
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  gap:1rem;
  box-shadow:0 6px 16px rgba(0,0,0,0.3);
}
#starterBox {
  margin:1rem 0;
  padding:0.8rem;
  background:#1f232d;
  border-radius:12px;
  cursor:pointer;
  transition: transform 0.2s;
}
#starterBox:hover { transform:scale(1.03); }
#starterTitle { font-weight:600; margin:0.5rem 0; color:#ffb86c; text-align:center; }
#chatArea {
  flex:1;
  display:flex;
  flex-direction:column;
  background: var(--bg-card);
  border-radius:16px;
  padding:1rem;
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
.message {
  max-width:75%;
  padding:0.8rem 1.2rem;
  margin-bottom:0.7rem;
  border-radius:20px;
  line-height:1.5;
  opacity:0;
  animation:fadeInMessage 0.5s forwards;
}
.user { background:var(--accent); color:#1b1f27; align-self:flex-end; }
.bot { background:var(--bg-card); align-self:flex-start; }

/* ------------------- FOOTER ------------------- */
footer {
  position: sticky;
  bottom:0;
  display:flex;
  padding:0.8rem;
  gap:0.5rem;
  background: var(--bg-card);
  z-index:10;
  align-items:center;
}
footer input { flex:1; padding:0.6rem; border-radius:12px; border:none; background:#1f232d; color:var(--text-main); }
footer button { padding:0.6rem 1rem; border-radius:999px; border:none; background: var(--accent); cursor:pointer; transition: all 0.3s ease; }
footer button:hover { transform: scale(1.05); background:#ff9f40; }
#micBtn { border-radius:50%; width:42px; height:42px; font-size:1.2rem; background: var(--accent); border:none; cursor:pointer; }
#micBtn.listening { animation:pulse 1.2s infinite; }
#micBtn.disabled { opacity:0.4; cursor:not-allowed; }

/* Privacy & Support */
#sidebarLinks {
  margin-top:auto;
  font-size:0.8rem;
  text-align:center;
}
#sidebarLinks a {
  color: var(--text-muted);
  text-decoration: none;
  margin: 0 0.4rem;
}
#sidebarLinks a:hover {
  text-decoration: underline;
  color: var(--accent);
}

/* Typing animations */
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
@keyframes fadeInMessage { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
@keyframes pulse {0%{box-shadow:0 0 0 0 rgba(255,184,108,0.6);} 70%{box-shadow:0 0 0 12px rgba(255,184,108,0);} 100%{box-shadow:0 0 0 0 rgba(255,184,108,0);}}

/* ------------------- FLOATING BUBBLES & SITE NAME ------------------- */
body::before {
  content:"";
  position:fixed;
  top:-50%;
  left:-50%;
  width:200%;
  height:200%;
  background: radial-gradient(circle, rgba(255,184,108,0.08) 10%, transparent 10%),
              radial-gradient(circle, rgba(255,184,108,0.06) 20%, transparent 20%);
  background-size: 100px 100px, 150px 150px;
  animation: moveBubbles 40s linear infinite;
  pointer-events:none;
  z-index:0;
}
@keyframes moveBubbles {
  0% { transform: translate(0,0) rotate(0deg); }
  50% { transform: translate(20px,-20px) rotate(180deg); }
  100% { transform: translate(0,0) rotate(360deg); }
}
body::after {
  content:"";
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:120px;
  background: linear-gradient(to top, rgba(255,184,108,0.06), transparent);
  animation: wave 8s ease-in-out infinite alternate;
  pointer-events:none;
  z-index:0;
}
@keyframes wave {
  0% { transform: translateX(0) translateY(0); }
  50% { transform: translateX(20px) translateY(-5px); }
  100% { transform: translateX(0) translateY(0); }
}
.siteName {
  position: relative;
  z-index: 1;
  display: inline-block;
}
.siteName::before {
  content:"";
  position:absolute;
  top:-10px; left:-10px;
  width:calc(100% + 20px); height:calc(100% + 20px);
  background: radial-gradient(circle, rgba(255,184,108,0.3), transparent 70%);
  border-radius:50%;
  animation: floatBubble 3s ease-in-out infinite alternate;
  z-index:-1;
}
@keyframes floatBubble {
  0% { transform: scale(1) translateY(0); }
  50% { transform: scale(1.05) translateY(-5px); }
  100% { transform: scale(1) translateY(0); }
}
</style>
</head>
<body>

<!-- ------------------- WELCOME OVERLAY ------------------- -->
<div id="welcomeOverlay">
  <div class="welcomeCard">
    <h3><span class="siteName">Talk 2Me Nice</span></h3>
    <p>Enter a nickname and choose your companion to start chatting.</p>
    
    <input id="nicknameOverlay" placeholder="Enter your nickname" />

    <div id="companionSelectorOverlay">
      <h4>Choose Your Companion</h4>
      <div class="companionGrid">
        <div class="companionCardOverlay" data-companion="Whisp">
          <h5>Whisp</h5>
          <p>Gentle, supportive, calm</p>
          <small>‚ÄúI‚Äôm here with you. Take your time.‚Äù</small>
        </div>
        <div class="companionCardOverlay" data-companion="Ace">
          <h5>Ace</h5>
          <p>Confident, playful, witty</p>
          <small>‚ÄúYou‚Äôve got my attention ‚Äî what‚Äôs on your mind?‚Äù</small>
        </div>
        <div class="companionCardOverlay" data-companion="Sage">
          <h5>Sage</h5>
          <p>Thoughtful, clear, insightful</p>
          <small>‚ÄúLet‚Äôs think this through carefully.‚Äù</small>
        </div>
        <div class="companionCardOverlay" data-companion="School">
          <h5>School Mode</h5>
          <p>Polite, age-appropriate, educational</p>
          <small>‚ÄúHow can I help you learn today?‚Äù</small>
        </div>
      </div>
    </div>

    <div id="landingOptions">
      <label>
        Language: 
        <select id="languageSelect">
          <option value="en-US" selected>English</option>
          <option value="es-ES">Spanish</option>
          <option value="fr-FR">French</option>
          <option value="de-DE">German</option>
        </select>
      </label>
      <label>
        <input type="checkbox" id="dummyModeToggle"> Dummy Mode (Test)
      </label>
    </div>

    <button id="startChatBtn">Start Chat</button>
  </div>
</div>

<!-- ------------------- CHAT CONTAINER ------------------- -->
<div id="chatContainer" class="hidden">
  <div id="profileSidebar">
    <div class="profileInfo">
      <p>üë§ <strong id="profileName"></strong></p>
      <p>üåç <span id="profileLanguage"></span></p>
      <p>üßö <span id="profileCompanion"></span></p>
    </div>
    <hr>
    <p id="starterTitle">Conversation Starters</p>
    <select id="starterDropdown" onchange="startStarter()">
      <option value="">-- Select Starter --</option>
    </select>
    <div id="voiceSettings">
      <h4>Voice Settings</h4>
      <label><input type="checkbox" id="voiceOutputToggle" checked> Voice replies</label>
      <label><input type="checkbox" id="voiceInputToggle" checked> Voice input</label>
      <label>Speech speed
        <select id="voiceSpeed">
          <option value="0.9">Slow</option>
          <option value="1" selected>Normal</option>
          <option value="1.1">Fast</option>
        </select>
      </label>
    </div>

    <div id="sidebarLinks">
      <a href="#">Privacy</a> | <a href="#">Support</a>
    </div>
  </div>

  <div id="chatArea">
    <div id="chat"></div>
  </div>
</div>

<footer class="hidden">
  <input id="userInput" placeholder="Type a message‚Ä¶" />
  <button id="micBtn" onclick="startSpeechToSpeech()">üé§</button>
  <button onclick="sendMessage()">Send</button>
  <button id="speechToSpeechBtn" class="active" onclick="toggleSpeechToSpeech()">üó£Ô∏è Speech-to-Speech: ON</button>
</footer>

<script>
/* ------------------- COMPANIONS ------------------- */
const companions = {
  Whisp: { name:"Whisp", description:"Gentle, supportive, calm", voice:{input:true, output:true, speakingStyle:"soft"} },
  Ace: { name:"Ace", description:"Confident, playful, witty", voice:{input:true, output:true, speakingStyle:"energetic"} },
  Sage: { name:"Sage", description:"Thoughtful, clear, insightful", voice:{input:true, output:true, speakingStyle:"neutral"} },
  School: { name:"School Mode", description:"Polite, age-appropriate, educational", voice:{input:false, output:true, speakingStyle:"clear"} }
};

/* ------------------- OVERLAY LOGIC ------------------- */
const companionCardsOverlay = document.querySelectorAll(".companionCardOverlay");
let selectedCompanionOverlay = localStorage.getItem("companion") || "Whisp";

function setActiveOverlayCompanion(id){
  companionCardsOverlay.forEach(card=>card.classList.remove("active"));
  document.querySelector(`.companionCardOverlay[data-companion='${id}']`)?.classList.add("active");
  selectedCompanionOverlay = id;
}
companionCardsOverlay.forEach(card=>card.addEventListener("click",()=>setActiveOverlayCompanion(card.dataset.companion)));
setActiveOverlayCompanion(selectedCompanionOverlay);

/* ------------------- START CHAT ------------------- */
document.getElementById("startChatBtn").addEventListener("click",()=>{
  const nickname = document.getElementById("nicknameOverlay").value.trim();
  if(!nickname){ alert("Please enter a nickname"); return; }

  localStorage.setItem("nickname", nickname);
  localStorage.setItem("companion", selectedCompanionOverlay);
  localStorage.setItem("language", document.getElementById("languageSelect").value);
  localStorage.setItem("dummyMode", document.getElementById("dummyModeToggle").checked);

  document.getElementById("welcomeOverlay").style.display = "none";
  startChat();
});

/* ------------------- DUMMY START CHAT ------------------- */
function startChat(){
  const nickname = localStorage.getItem("nickname") || "Friend";
  const companion = localStorage.getItem("companion") || "Whisp";
  const language = localStorage.getItem("language") || "en-US";
  document.getElementById("chatContainer").classList.remove("hidden");
  document.querySelector("footer").classList.remove("hidden");
  document.getElementById("profileName").textContent = nickname;
  document.getElementById("profileCompanion").textContent = companion;
  document.getElementById("profileLanguage").textContent = language;

  populateStarters();
  applyVoiceRules();
}

/* ------------------- STARERS ------------------- */
const conversationStarters = {
  "Workplace":[`Good morning! How's your day starting?`,`Hi! Did you catch the latest project update?`,`Evening! Ready to wrap things up?`],
  "Dating & Social":[`Hi there! Would you like to grab coffee?`,`Hey! Want to take a walk this afternoon?`,`Hello! How was your day today?`],
  "Travel":[`Hi! Where is the nearest train station?`],
  "School":[`Hello! How was class today?`,`Do you need help with homework?`],
  "Advanced Small Talk":[`Hello! Did you see the game yesterday?`]
};
function populateStarters(){
  const dd = document.getElementById("starterDropdown");
  dd.innerHTML = `<option value="">-- Select Starter --</option>`;
  Object.keys(conversationStarters).forEach(cat=>{
    conversationStarters[cat].forEach(phrase=>{
      const opt = document.createElement("option");
      opt.value = phrase; opt.textContent = `${cat}: ${phrase}`;
      dd.appendChild(opt);
    });
  });
}
function startStarter(){
  const val = document.getElementById("starterDropdown").value;
  if(val) sendMessage(val);
}

/* ------------------- CHAT HANDLER ------------------- */
const chat = document.getElementById("chat");
function addMessage(text,sender){
  const div=document.createElement("div");
  div.className=`message ${sender}`;
  div.textContent=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}
function sendMessage(msg=null){
  const input=document.getElementById("userInput");
  const text = msg || input.value.trim();
  if(!text) return;
  addMessage(text,"user");
  input.value="";

  // Dummy response
  setTimeout(()=>addMessage(`Echo: ${text}`,"bot"),500);
}

/* ------------------- VOICE SETTINGS ------------------- */
const voiceOutputToggle = document.getElementById("voiceOutputToggle");
const voiceInputToggle = document.getElementById("voiceInputToggle");
const voiceSpeed = document.getElementById("voiceSpeed");
function applyVoiceRules(){
  const companionId = localStorage.getItem("companion") || "Whisp";
  const companionData = companions[companionId];
  const settings = { output: voiceOutputToggle.checked, input: voiceInputToggle.checked, speed: voiceSpeed.value };
  micBtn.disabled = !companionData.voice.input || !settings.input;
  windowVoiceOutputAllowed = companionData.voice.output && settings.output;
  windowVoiceSpeed = settings.speed;
}
voiceOutputToggle.onchange = voiceInputToggle.onchange = voiceSpeed.onchange = applyVoiceRules;
let windowVoiceOutputAllowed=true, windowVoiceSpeed=1;
function speakBotText(text){
  if(!windowVoiceOutputAllowed) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = localStorage.getItem("language") || "en-US";
  utter.rate = windowVoiceSpeed;
  speechSynthesis.speak(utter);
}

/* ------------------- SPEECH-TO-SPEECH ------------------- */
let speechMode=true;
const speechBtn = document.getElementById("speechToSpeechBtn");
function toggleSpeechToSpeech(){
  speechMode=!speechMode;
  speechBtn.classList.toggle("active",speechMode);
  speechBtn.textContent=`üó£Ô∏è Speech-to-Speech: ${speechMode ? 'ON':'OFF'}`;
}
function startSpeechToSpeech(){
  if(!speechMode || micBtn.disabled) return;
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = localStorage.getItem("language") || "en-US";
  recognition.interimResults=false; recognition.continuous=false;
  micBtn.classList.add("listening");
  recognition.onresult=(event)=>{
    const spoken = event.results[0][0].transcript;
    sendMessage(spoken);
  };
  recognition.onend=()=>{ micBtn.classList.remove("listening"); if(speechMode) setTimeout(()=>recognition.start(),300);}
  recognition.start();
}
</script>

</body>
</html>
